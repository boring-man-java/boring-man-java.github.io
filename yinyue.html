　　<!DOCTYPE html>
<html lang="zh-CN">
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>听音乐-无聊侠的笨蛋网</title>
<style>
body{margin: 0;padding: 0;}

	#lrcArea ul,#lrcArea li,#lrcArea ol,#lrcArea p{margin: 0;padding: 0; list-style: none}
	.container{margin: 10px;}
	#lrcArea{
		height: 290px;
		overflow: auto;
		width: 200px;
		border:1px solid #ccc;
		padding:0 5px;
		margin-top: 10px;
	}
	#lrcArea ul{
		font-size: 12px;
		color: #5c5c5c;
		line-height: 22px;
	}
	#lrcArea ul li{}
	#lrcArea ul li.cur{
		color: #16CDF9;
	}
</style>
<body>
 <div class="container">
 <audio id="player" src="https://gitee.com/boring-man/yinyue/raw/master/陈奕迅 - 抱拥这分钟.mp3" loop controls preload></audio>
 <div id="lrcArea"></div>
 </div>
 
 <script id="lrc" type="text">
 //lrc歌词
抱拥这分钟歌词
歌手:陈奕迅

曲/监:Jim Lee
词:潘源良 编:Lorn Leber
忘记了世界这分钟
跌进了这爱的裂缝
燃亮烛光
只管相拥
来占据了这晚星空
捉紧一刹那的认同
如梦的将来
尽管一点不懂
完全明白是放纵
但是只得这刻可相信
未来又怕会
终于都扑空
你叫我最快乐你也叫我最心痛
爱在迷惘中
你叫我最渴望
却也叫我猜不中
谁可以这样折衷
曾与你爱过却匆匆
过去己有太多类同
谁在心中
怎猜得准
能跌进这晚爱火中
彷佛一切已经共同
仍是不敢祈求
热恋多一分钟
要说永远爱吧
却怕仍然未相信
永未能看通
要说这晚算吧
却觉爱己经失控
宁愿再继续抱拥
Oh......
相拥......
心痛......
 </script>
<div class="container">

 <audio id="player" src="http://music.163.com/song/media/outer/url?id=65766.mp3" loop controls preload></audio>
 <div id="lrcArea"></div>
 </div>
 
 <script id="lrc" type="text">
 //lrc歌词
[00:00.000] 作词 : 林夕
[00:01.000] 作曲 : Christopher Chak
[00:02.000]编曲 : 陈珀 / C.Y.Kong
[00:03.000]
[00:22.261]拦路雨偏似雪花 饮泣的你冻吗
[00:26.764]这风褛我给你磨到有襟花
[00:31.323]连调了职也不怕 怎么始终牵挂
[00:35.918]苦心选中今天想车你回家
[00:40.481]原谅我不再送花 伤口应要结疤
[00:45.039]花瓣铺满心里坟场才害怕
[00:49.637]如若你非我不嫁 彼此终必火化
[00:54.178]一生一世等一天需要代价
[00:58.738]谁都只得那双手靠拥抱亦难任你拥有
[01:03.913]要拥有必先懂失去怎接受
[01:08.478]曾沿着雪路浪游 为何为好事泪流
[01:13.033]谁能凭爱意要富士山私有
[01:17.592]何不把悲哀感觉假设是来自你虚构
[01:22.213]试管里找不到它染污眼眸
[01:26.705]前尘硬化像石头 随缘地抛下便逃走
[01:34.443]我绝不罕有 往街里绕过一周
[01:38.859]我便化乌有
[01:42.940]情人节不要说穿 只敢抚你发端
[01:47.493]这种姿态可会令你更心酸
[01:52.095]留在汽车里取暖 应该怎么规劝
[01:56.677]怎么可以将手腕忍痛划损
[02:01.253]人活到几岁算短 失恋只有更短
[02:05.801]归家需要几里路谁能预算
[02:10.389]忘掉我跟你恩怨 樱花开了几转
[02:14.997]东京之旅一早比一世遥远
[02:19.526]谁都只得那双手靠拥抱亦难任你拥有
[02:24.693]要拥有必先懂失去怎接受
[02:29.241]曾沿着雪路浪游 为何为好事泪流
[02:33.812]谁能凭爱意要富士山私有
[02:38.388]何不把悲哀感觉假设是来自你虚构
[02:42.982]试管里找不到它染污眼眸
[02:47.510]前尘硬化像石头 随缘地抛下便逃走
[02:54.514]我绝不罕有 往街里绕过一周
[02:59.366]我便化乌有
[03:03.614]谁都只得那双手靠拥抱亦难任你拥有
[03:08.990]要拥有必先懂失去怎接受
[03:13.692]曾沿着雪路浪游 为何为好事泪流
[03:18.456]谁能凭爱意要富士山私有
[03:23.150]何不把悲哀感觉假设是来自你虚构
[03:27.863]试管里找不到它染污眼眸
[03:32.549]前尘硬化像石头 随缘地抛下便逃走
[03:41.586]我绝不罕有 往街里绕过一周
[03:46.887]我便化乌有
[03:52.310]你还嫌不够 我把这陈年风褛 送赠你解咒
[04:01.303]
[04:03.000]Produced by 梁荣骏
[04:04.000]Production Coordination: Stanley Leung
[04:05.000]Keyboards & Programming: 陈珀 / C.Y.Kong (江志仁)
[04:06.000]Drums: Davy Chan (陈匡荣)
[04:07.000]Bass: 细威
[04:08.000]Guitar: Joey Tang (邓建明)
[04:09.000]Percussion: Davy Chan & Kevin (Hardpack)
[04:10.000]Strings Arranged & Conducted by 陈珀
[04:11.000]Recorded at aroom studio & seewisehk,
[04:12.000]Engineered by Davy Chan, Rob Porter & C.Y.Kong
[04:13.000]Vocals Recorded at Avon Studios,
[04:14.000]Engineered by Anthony Leung
[04:15.000]Mixed by Simon Li at nOiz
[04:16.000]OP: Forward Music Publishing Co Ltd / EMI Music Publishing (S.E. Asia) Ltd, Taiwan Branch
[04:17.000]SP: EMI Music Publishing HK
 </script>
<script>
var musicPlayer = function() {
 			return this.init.apply(this, arguments);
 		};

 		musicPlayer.prototype = {
 			constructor: musicPlayer,
 			init:function(options) {
 				if(isEmptyObj(options) || typeof options !== 'object') return;
 				this.player = options.player;
 				this.lrc = options.lrc;
 				this.lrcArea = options.lrcArea;
 				//用于保存歌词
 				this.lrcArr = [];
 				//用于保存时间戳
 				this.timestamp = [];
 				//处理歌词
 				this.handleLrc(this.lrc);
 				var that = this;

 				this.player.addEventListener('play', function() {
 					that.play();
 				}, false);

 				this.player.addEventListener('pause',function() {
 					that.pause();
 				}, false);

 				//歌词索引
 				this.idx = 0;
 			},
 			//格式化歌词
 			handleLrc:function(lrc) {
 				var re = /(\[.+\])(.+)?/gm,
 					ul = cEl('ul'),
 					frag = document.createDocumentFragment(),
 					tmpArr,i,len;
 				this.lrcArea.innerHTML = '';
 				frag.appendChild(ul);
 				ul.id = 'c';
 				this.lrcArea.appendChild(frag);

 				var	txt = lrc.replace(re,function(a,b,c) {
					return b + (c === undefined ? '&nbsp;' : c) + '\n';
				});

				tmpArr = txt.split('\n');

				//处理歌词
				for(i = 0,len = tmpArr.length; i < len; i++) {
					var item = trim(tmpArr[i]);
					if(item.length > 0) {
						this.lrcArr.push(item);
					}
				}
				
				frag = document.createDocumentFragment();

				for(i = 0,len = this.lrcArr.length; i < len; i++) {
					var li = cEl('li');
					if(i === 0) {
						li.className = 'cur';
					}
					li.innerHTML = this.lrcArr[i].replace(/\[.+\]/i,'')
.replace('// ]]>','').replace('//','');
					//处理时间
					this.timestamp.push(this.lrcArr[i].replace(re,function(a,b,c) {
						return b;
					}).replace('[','').replace(']',''));
					frag.appendChild(li);
				}

				ul.appendChild(frag);
				this.li = g('lrcArea').getElementsByTagName('li');
 			},
 			//播放
 			play:function() {
 				this.stop = false;
 				var that = this,
 					player = this.player,
 					i,len;

 				this.t = setInterval(function() {
 					if(that.stop) return;
 					that.curTime = player.currentTime;

 					for(i = 0,len = that.timestamp.length - 1; i < len; i++) {
 						var	prevTime = that.formatTimeStamp( that.timestamp[i] ),
 							nextTime = that.formatTimeStamp( that.timestamp[i + 1] );
 						//当前播放时间与前后歌词时间比较，如果位于这两者之间则转到该歌词
 						if( parseFloat( that.curTime ) > prevTime && parseFloat( that.curTime ) < nextTime ) {
 							that.scrollToLrc(i);
 							return;
 						}
 					}
 				},300);
 			},
 			//暂停
 			pause:function() {
 				this.stop = true;
 				clearInterval(this.t);
 			},
 			//格式化时间
 			formatTimeStamp:function(timestamp) {
 				var re = /([0-9]+):([0-9]+)\.([0-9]+)/i,
 					seconds = timestamp.replace(re,function(a,b,c,d) {
 						return Number(b * 60) + Number(c) + parseFloat('0.'+ d);
 					});
 				return seconds; 
 			},
 			//歌词滚动
 			scrollToLrc:function(idx) {
 				var ds = getOffset(this.li[idx]).top,
 					i,len;
 				//如果歌词索引没有变动，则认为这句没有唱完，不处理
 				if(this.idx === idx) return;
 				//否则更新索引值并更新样式和位置
 				this.idx = idx;
 				for(i = 0,len = this.li.length; i < len; i++) {
 					this.li[i].className = '';
 				}
 				this.li[idx].className = 'cur';
 				this.lrcArea.scrollTop = ds - this.lrcArea.offsetHeight / 2;
 			}
 		};

 		function g(id) {
 			return typeof id === 'string' ? document.getElementById(id) : id;
 		}
 		function cEl(el) {
 			return document.createElement(el);
 		}
 		function trim(str) {
 			return str.replace(/(^\s*)|(\s*$)/g, "");
 		}
 		function isEmptyObj(o) {
 			for(var p in o) return false;
			return true;
 		}
 		function getOffset(el) {
 			var parent = el.offsetParent,
 				left = el.offsetLeft,
 				top = el.offsetTop;

 			while(parent !== null) {
 				left += parent.offsetLeft;
 				top += parent.offsetTop;
 				parent = parent.offsetParent;
 			}

 			return {
 				left: left,
 				top: top
 			};
 		}

 		var p = new musicPlayer({
 			player: g('player'),
 			lrc: g('lrc').innerHTML,
 			lrcArea: g('lrcArea')
 		});
</script>
</body>
</html>
